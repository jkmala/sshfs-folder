# Oma moduuli - myy-asema sshfs:llä

Tavoitetilana oli saada Haaga-helian myy-palvelimen tiedostot käyttöön, kun käyttää liveusb-tikulta ladattua käyttöjärjestelmää.

Löysin [esimerkkin](https://lessknown.info/2011/08/managing-sshfs-with-puppet/), jonka avulla aloitin projektin. Täältä löytyi myös tieto, että ssh-passprhase pitää olla tyhjä.

Ongelmia:
- SSH avaimet oikeassa paikassa? virheteksti: "connection reset by peer"
- Olisko joku resurssi ssh_keygen?
- ei varmaan ole tietoturvallista säilyttää private avainta github -kansiossa.

[init.pp] (https://github.com/jkmala/sshfs-folder/blob/master/modules/sshfs-liveusb/manifests/init.pp)

Ensimmäisellä ajolla:

    xubuntu@xubuntu:~$ sudo puppet apply --modulepath sshfs-folder/modules/ -e 'class {"sshfs-liveusb":}'
    Notice: Compiled catalog for xubuntu.tielab.haaga-helia.fi in environment production in 0.33 seconds
    Notice: /Stage[main]/Sshfs-liveusb/File[/home/xubuntu/koulu/]/ensure: created
    Notice: /Stage[main]/Sshfs-liveusb/Package[sshfs]/ensure: ensure changed 'purged' to 'present'
    Notice: /Stage[main]/Sshfs-liveusb/Mount[kouludir]/ensure: defined 'ensure' as 'mounted'
    Error: /Stage[main]/Sshfs-liveusb/Mount[kouludir]: Could not evaluate: Execution of '/bin/mount /home/xubuntu/koulu' returned 1: read: Connection reset by peer
    Notice: Finished catalog run in 1.54 seconds

etc/fstab muuttui:

    xubuntu@xubuntu:~$ cat /etc/fstab 
    # HEADER: This file was autogenerated at 2017-05-16 11:02:31 +0000
    # HEADER: by puppet.  While it can still be managed manually, it
    # HEADER: is definitely not recommended.
    overlay	/	overlay	rw	0	0
    tmpfs	/tmp	tmpfs	nosuid,nodev	0	0
    sshfs#a1402745@myy.haaga-helia.fi:/netapp/nfstiko/u10/	/home/xubuntu/koulu	fuse	idmap=user,uid=999,gid=999,-p22,-C,IdentityFile=/home/xubuntu/.ssh/id_rsa,allow_other	0	0

Saan koulun myy-kansion kivasti näkymään, antamalla komennon:
> sudo mount -a

    xubuntu@xubuntu:~$ sudo mount -a
    The authenticity of host 'myy.haaga-helia.fi (193.166.9.27)' can't be established.
    RSA key fingerprint is SHA256:TOTRrJMcjUkPRi5MTPt+btxVzmOE8LNHwILsXTWji7I.
    Are you sure you want to continue connecting (yes/no)? yes
    a1402745@myy.haaga-helia.fi's password: 
    xubuntu@xubuntu:~$ cd koulu
    xubuntu@xubuntu:~/koulu$ ls
    a0002013  a1200151  a1300535  .... ....
    
Löytyykö sinunkin opiskelijanumerosi täältä?

Vika on varmaan avaimissa tai siinä että puppet ei voi ohittaa ssh-avainten passprhasea tai . Generoin avaimet uudelleen ja vien myy.haaga-helia.fi palvelimelle oman julkisen avaimen komennolla:
> ssh-copy-id a1402745@myy.haaga-helia.fi

Vien private-avaimeni template-tiedostoksi, mutta en saa niitä siirretty puppetilla:




Valitettavasti en saanut toimimaan :(

Kurssin muut tehtävät:
1. https://jkmala.wordpress.com/2017/04/04/1-tunti-puppetin-hallinta/
2. https://github.com/jkmala/linuxcourse/blob/master/2nd_homework.md
3. https://github.com/jkmala/linuxcourse/blob/master/sshd/homework3.md
